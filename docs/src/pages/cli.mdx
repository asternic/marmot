---
title: Marmot CLI
---

# Marmot CLI Documentation

## Usage

You can run Marmot like this:

```bash
marmot --config /path/to/config.toml -cluster-addr localhost:4221 -cluster-peers 'nats://localhost:4222/'
```

You can clean up marmot triggers and changelogs this:

```bash
marmot --config /path/to/config.toml --cleanup
```

You can take snapshot and upload:

```bash
marmot --config /path/to/config.toml --save-snapshot
```

Minimal Config

```toml
seq_map_path="/tmp/marmot-1-sm.cbor"
db_path="/tmp/marmot-1.db"
node_id=1
```

## Flags

- `--config`: Path to the configuration file.
- `--cleanup`: If set, only cleanup marmot triggers and changelogs.
- `--save-snapshot`: If set, only take snapshot and upload.
- `--cluster-addr`: Cluster listening address.
- `--cluster-peers`: Comma separated list of clusters.
- `--leaf-servers`: Comma separated list of leaf servers.

## Configuration

The configuration file is in TOML format and contains the following sections:

### Snapshot Configuration

- `enabled`: Enable snapshotting.
- `interval`: Interval for taking snapshots.
- `store`: Type of storage for snapshots. Options are "nats", "s3", "webdav", "sftp".
- `nats`: NATS object store configuration.
- `s3`: S3 configuration.
- `webdav`: WebDAV configuration.
- `sftp`: SFTP configuration.

### Replication Log Configuration

- `shards`: Number of shards.
- `max_entries`: Maximum number of entries.
- `replicas`: Number of replicas.
- `compress`: Enable compression.
- `update_existing`: Update existing entries.

### NATS Configuration

- `urls`: NATS server URLs.
- `subject_prefix`: Subject prefix for NATS messages.
- `stream_prefix`: Stream prefix for NATS messages.
- `server_config`: Server configuration file for NATS.
- `seed_file`: Seed file for NATS.
- `user_name`: User name for NATS.
- `user_password`: User password for NATS.
- `ca_file`: CA file for NATS.
- `cert_file`: Certificate file for NATS.
- `key_file`: Key file for NATS.
- `bind_address`: Bind address for NATS.
- `connect_retries`: Number of connection retries for NATS.
- `reconnect_wait_seconds`: Wait time in seconds before reconnecting to NATS.

### Logging Configuration

- `verbose`: Enable verbose logging.
- `format`: Logging format.

### Prometheus Configuration

- `bind`: Bind address for Prometheus.
- `enable`: Enable Prometheus.
- `namespace`: Namespace for Prometheus.
- `subsystem`: Subsystem for Prometheus.



## Sample Config File

```toml 
[replication_log]
shards = 1
max_entries = 1024
replicas = 1
compress = true
update_existing = false

[snapshot]
enabled = true
interval = 0
store = "nats"

[snapshot.nats]
replicas = 1
bucket = "bucket-name"

[snapshot.s3]
path = "path"
endpoint = "endpoint"
access_key = "access-key"
secret = "secret-key"
session_token = "session-token"
bucket = "bucket-name"
use_ssl = true

[snapshot.webdav]
url = "webdav-url"

[snapshot.sftp]
url = "sftp-url"

[nats]
urls = ["nats-url"]
subject_prefix = "marmot-change-log"
stream_prefix = "marmot-changes"
server_config = "server-config"
seed_file = "seed-file"
user_name = "user-name"
user_password = "user-password"
ca_file = "ca-file"
cert_file = "cert-file"
key_file = "key-file"
bind_address = ":-1"
connect_retries = 5
reconnect_wait_seconds = 2

[logging]
verbose = false
format = "console"

[prometheus]
bind = ":3010"
enable = false
namespace = "marmot"
subsystem = ""

seq_map_path = "seq-map-path"
db_path = "db-path"
node_id = 1
publish = true
replicate = true
scan_max_changes = 512
cleanup_interval = 5000
sleep_timeout = 0
polling_interval = 0
```